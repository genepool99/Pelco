# Peltrack

## A Pelco-D Rotor Controller with Web Interface for Ham Radio Operators

This project provides a Python-based controller for antenna rotators using the Pelco-D protocol. It includes:
- A calibration tool
- A web-based debug/control interface
- A TCP server compatible with EasyComm & Hamlib)
- Live UI updates when controlled externally (e.g., by Gpredict)

---

## ğŸï¸ Features

- Serial communication with Pelco-D compatible pan/tilt rotors
- Web UI with real-time position feedback and visualizer
- TCP server for satellite tracking via **Gpredict**
- Calibration tool to measure rotor speed (Â°/sec)
- Supports full elevation + azimuth movement
- Accurate state persistence across manual + automated control

---

## ğŸ”§ Requirements

- Python 3.10+
- Pelco-D compatible rotator (via RS-485)
- USBâ€“RS485 adapter (e.g., CH340, FTDI)
- `requirements.txt` dependencies

### Install Dependencies

```bash
python -m venv venv
venv\Scripts\activate             # Windows
# OR
source venv/bin/activate         # macOS/Linux

pip install -r requirements.txt
```

---

## ğŸš€ Usage

### 1. Calibrate the Rotor

Accurate rotor control requires knowing your rotorâ€™s **degrees per second** speed.

#### Initial Setup

- Connect your rotator via RS-485 and power it on.
- Rotate azimuth to its **leftmost mechanical stop**, then **center it facing true North**.
- Tilt the antenna so it is **pointing straight up**.
- This becomes your reference: **Az = 0Â°, El = 90Â°**.

#### Run Calibration

```bash
python calibrate.py
```

- Follow the prompts.
- The tool measures speed by rotating for 10 seconds.
- You enter how far it turned.
- Results are saved in `config.json`.

---

### 2. Start the Web + Gpredict Server

```bash
python peltrack.py --port COM4 --baud 2400
```

This starts:

- âœ… Web UI on [http://localhost:5000](http://localhost:5000)
- âœ… Gpredict-compatible TCP server on port **4533**

Gpredict can now command rotor movement â€” the Web UI updates live.

---

## ğŸŒ Web Interface

Features:
- View current azimuth and elevation
- Absolute move commands
- Elevation nudges (â†‘/â†“)
- Set to "horizon" (el=0)
- Visual dial + bar graph
- "Run Demo" simulates satellite pass
- Live updates if rotor is moved externally (e.g. by Gpredict)

---

## ğŸ› Gpredict Setup

1. Open Gpredict Preferences â†’ Interfaces â†’ Rotator
2. Add a new interface:
   - **Hostname**: `localhost`
   - **Port**: `4533`
   - **Protocol**: `Hamlib rotctld` or `EasyComm II`
3. Enable rotator interface during satellite passes.

---

## ğŸ“œ Resetting / Re-Zeroing

If the rotor is bumped, moved manually, or drifts:

- Use the Web UIâ€™s **"Reset Position"** to mark current position as 0/0
- Or from Python:

```python
from state import reset_position
reset_position()
```

You can also **re-run the calibration script** at any time.

---

## ğŸ” Live Sync with Gpredict

When Gpredict sends new commands, the Web UI **automatically updates** in real-time to reflect the current position.

No page refresh needed â€” uses `Flask-SocketIO` + `eventlet`.

---

## ğŸ§ª Tested With

- Windows 11 + Python 3.11
- CH340 USBâ€“RS485 adapter
- [Gpredict 2.3](https://gpredict.oz9aec.net/)
- [SkyRoof 1.15 Beta](https://skyroof.org/)

---

## ğŸ“ Project Structure

```
peltrack/
â”œâ”€â”€ calibrate.py           # CLI calibration tool
â”œâ”€â”€ config.json            # Saved calibration data (az/el speed)
â”œâ”€â”€ easycomm_server.py     # TCP server for Gpredict
â”œâ”€â”€ page_template.py       # Web UI HTML template
â”œâ”€â”€ pelco_commands.py      # Rotor control logic
â”œâ”€â”€ peltrack.py            # Flask + SocketIO + TCP bridge
â”œâ”€â”€ requirements.txt       # Dependencies
â”œâ”€â”€ state.py               # Shared config/state/limits
â””â”€â”€ limits.json            # Optional Az/El range limits 
```

---

## ğŸ“Œ License

MIT License. Use at your own risk.

---

## ğŸš€ Credits

2025 â€” Avi Solomon (AE7ET)
